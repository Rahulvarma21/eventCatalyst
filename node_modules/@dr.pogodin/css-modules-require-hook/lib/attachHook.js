"use strict";

/* eslint-disable no-underscore-dangle */

/**
 * @param {function} compile
 * @param {string}   extension
 * @param {function} isException
 */
module.exports = function attachHook(compile, extension, isException) {
  var existingHook = require.extensions[extension];
  require.extensions[extension] = function cssModulesHook(m, filename) {
    if (isException(filename)) {
      existingHook(m, filename);
      return undefined;
    }
    var tokens = compile(filename);
    return m._compile("module.exports = ".concat(JSON.stringify(tokens)), filename);
  };
};