{"version":3,"file":"resolvePaths.js","names":["parseValues","stringifyValues","require","relative","resolve","sep","isNonRootUrl","filepath","test","isRelativeUrl","exports","normalizeUrl","iterateValues","resolvePaths","value","replace","values","iteratee","nodes","forEach","item","ast","from","to","walkAtRules","atrule","name","params","type","resolveUrl","url","walkDecls","decl","resolvedUrl"],"sources":["../src/resolvePaths.js"],"sourcesContent":["'use strict';\n\nconst {parseValues, stringifyValues} = require('css-selector-tokenizer');\nconst {relative, resolve, sep} = require('path');\n\nconst isNonRootUrl = filepath => !/^\\//.test(filepath);\nconst isRelativeUrl = filepath => /^(?:\\.\\.?(?:[\\\\\\/]|$))/.test(filepath);\n\nexports.normalizeUrl = normalizeUrl;\nexports.isNonRootUrl = isNonRootUrl;\nexports.isRelativeUrl = isRelativeUrl;\nexports.iterateValues = iterateValues;\nexports.resolvePaths = resolvePaths;\n\nfunction normalizeUrl(value) {\n  return value.replace(/\\\\/g, '/');\n}\n\nfunction iterateValues(values, iteratee) {\n  values.nodes.forEach(value =>\n    value.nodes.forEach(item => iteratee(item)));\n}\n\nfunction resolvePaths(ast, from, to) {\n  // @import\n  ast.walkAtRules(atrule => {\n    if (atrule.name === 'import') {\n      const values = parseValues(atrule.params);\n\n      iterateValues(values, item => {\n        if (item.type === 'string' && isNonRootUrl(item.value))\n          item.value = resolveUrl(item.value, from, to);\n\n        if (item.type === 'url' && isNonRootUrl(item.url))\n          item.url = resolveUrl(item.url, from, to);\n      });\n\n      atrule.params = stringifyValues(values);\n    }\n  });\n\n  // background: url(..)\n  ast.walkDecls(decl => {\n    if (/url/.test(decl.value)) {\n      const values = parseValues(decl.value);\n\n      iterateValues(values, item => {\n        if (item.type === 'url' && isNonRootUrl(item.url))\n          item.url = resolveUrl(item.url, from, to);\n      });\n\n      decl.value = stringifyValues(values);\n    }\n  });\n}\n\nfunction resolveUrl(url, from, to) {\n  const resolvedUrl = relative(to, resolve(from, url));\n\n  return normalizeUrl(\n    isRelativeUrl(url)\n    ? '.' + sep + resolvedUrl\n    : resolvedUrl\n  );\n}\n"],"mappings":"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"}