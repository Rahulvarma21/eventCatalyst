{"version":3,"file":"resolveModule.js","names":["join","parse","resolve","require","readFileSync","statSync","realpathSync","minimist","argv","process","slice","boolean","PRESERVE_SYMLINKS","String","env","NODE_PRESERVE_SYMLINKS","exports","applyAliases","isDirectory","isFile","isNodeModule","nodeModulesPaths","resolveAsDir","resolveAsFile","resolveModule","filepath","aliases","keys","Object","i","length","key","startsWith","replace","er","code","test","start","paths","parsed","dir","root","push","map","directory","mainFile","pkgfile","body","pkg","JSON","main","e","extensions","extension","file","cwd","resolvecfg","preserveSymlinks","undefined","Boolean","alias","dirs","modules","concat","abspath","result"],"sources":["../src/resolveModule.js"],"sourcesContent":["'use strict';\n\nconst {join, parse, resolve} = require('path');\nconst {readFileSync, statSync, realpathSync} = require('fs');\nconst minimist = require('minimist');\n\nconst argv = minimist(process.argv.slice(2), {\n  boolean: ['preserve-symlinks'],\n});\n\nconst PRESERVE_SYMLINKS = argv['preserve-symlinks'] ||\n  String(process.env.NODE_PRESERVE_SYMLINKS) === '1';\n\nexports.applyAliases = applyAliases;\nexports.isDirectory = isDirectory;\nexports.isFile = isFile;\nexports.isNodeModule = isNodeModule;\nexports.nodeModulesPaths = nodeModulesPaths;\nexports.resolveAsDir = resolveAsDir;\nexports.resolveAsFile = resolveAsFile;\nexports.resolveModule = resolveModule;\n\nfunction applyAliases(filepath, aliases = {}) {\n  const keys = Object.keys(aliases);\n\n  for (let i = 0; i < keys.length; ++i) {\n    const key = keys[i];\n\n    if (filepath.startsWith(key)) return filepath.replace(key, aliases[key]);\n  }\n\n  return filepath;\n}\n\nfunction isDirectory(filepath) {\n  try {\n    return statSync(filepath).isDirectory();\n  } catch (er) {\n    if (er && er.code === 'ENOENT') return false;\n    throw er;\n  }\n}\n\nfunction isFile(filepath) {\n  try {\n    return statSync(filepath).isFile();\n  } catch (er) {\n    if (er && er.code === 'ENOENT') return false;\n    throw er;\n  }\n}\n\n// ../ | ./ | / | c:\\\nfunction isNodeModule(filepath) {\n  return !/^(?:\\.\\.?(?:[\\\\\\/]|$)|\\/|[A-Za-z]:[\\\\\\/])/.test(filepath);\n}\n\nfunction nodeModulesPaths(start) {\n  const paths = [start];\n  let parsed = parse(start);\n\n  while (parsed.dir !== parsed.root) {\n    paths.push(parsed.dir);\n    parsed = parse(parsed.dir);\n  }\n\n  paths.push(parsed.root);\n\n  return paths.map(directory => join(directory, 'node_modules'));\n}\n\nfunction resolveAsDir(filepath, mainFile = 'index.css') {\n  const pkgfile = join(filepath, 'package.json');\n\n  if (isFile(pkgfile)) {\n    const body = readFileSync(pkgfile, 'utf8');\n\n    try {\n      const pkg = JSON.parse(body);\n\n      if (pkg.main) return resolveAsFile(join(filepath, pkg.main)) ||\n        resolveAsDir(join(filepath, pkg.main), mainFile);\n    } catch (e) {} // eslint-disable-line no-empty\n  }\n\n  return resolveAsFile(join(filepath, mainFile));\n}\n\nfunction resolveAsFile(filepath, extensions = []) {\n  if (isFile(filepath)) return filepath;\n\n  for (let i = 0; i < extensions.length; ++i) {\n    const extension = extensions[i];\n    const file = filepath + extension;\n\n    if (file === filepath) continue;\n    if (isFile(file)) return file;\n  }\n}\n\nfunction resolveModule(filepath, {cwd, resolve: resolvecfg = {}}) {\n  const preserveSymlinks = resolvecfg.preserveSymlinks !== undefined\n    ? Boolean(resolvecfg.preserveSymlinks) : PRESERVE_SYMLINKS;\n  const file = applyAliases(filepath, resolvecfg.alias);\n  const dirs = isNodeModule(file)\n    ? (resolvecfg.modules || []).concat(nodeModulesPaths(cwd))\n    : (resolvecfg.modules || []).concat(cwd);\n\n  for (let i = 0; i < dirs.length; ++i) {\n    const directory = dirs[i];\n\n    if (!isDirectory(directory)) continue;\n\n    const abspath = resolve(directory, file);\n    const result = resolveAsFile(abspath, resolvecfg.extensions) ||\n      resolveAsDir(abspath, resolvecfg.mainFile);\n\n    if (result) return preserveSymlinks ? result : realpathSync(result);\n  }\n}\n"],"mappings":"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"}